C51 COMPILER V9.54   TIME                                                                  09/18/2022 21:48:24 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE TIME
OBJECT MODULE PLACED IN .\Objects\Time.obj
COMPILER INVOKED BY: D:\ying_yong\keil5\C51\BIN\C51.EXE ..\CODE\Time.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\INC) DEBUG OBJ
                    -ECTEXTEND PRINT(.\Listings\Time.lst) TABS(2) OBJECT(.\Objects\Time.obj)

line level    source

   1          #include "Time.h"
   2          /*注意当time0和time1同时打开时请设置
   3           *c51_time.time0_ms
   4           *c51_time.time1_ms
   5           *两个都要大于3
   6           *此时如果有动态数码管那么会看到明显闪烁
   7           *平常使用时尽量只开一个定时器
   8           */
   9          #if TIME_
  10          static void time_again_init(create_time * time_object);
  11          /**
  12            * @brief          初始化time对象
  13            * @param[in]      time_object：time对象指针
  14            * @retval         NULL
  15            */
  16          void time_init(create_time *time_object)
  17          {
  18   1         time_object->time_run_func_handle=time_run_func_handle;
  19   1         time_object->time_again_init=time_again_init;
  20   1        
  21   1        
  22   1         if(time_object->time0==TIME0ON&&time_object->time1==TIME1OFF)
  23   1         {
  24   2            
  25   2           TMOD=0x01;//设置定时器0为工作方式1
  26   2           TH0=(65536-(921600/(1000/time_object->time0_ms)))/256;
  27   2           TL0=(65536-(921600/(1000/time_object->time0_ms)))%256;
  28   2           EA=1;//中断总控制位
  29   2           ET0=1;//定时器中断运行位
  30   2           TR0=1;//定时器0运行控制位
  31   2           
  32   2         }
  33   1         else if(time_object->time0==TIME0OFF&&time_object->time1==TIME1ON)
  34   1         {
  35   2            
  36   2           TMOD=0x10;//设置定时器1为工作方式1
  37   2           TH1=(65536-(921600/(1000/time_object->time1_ms)))/256;
  38   2           TL1=(65536-(921600/(1000/time_object->time1_ms)))%256;
  39   2           EA=1;//中断总控制位
  40   2           ET1=1;//定时器中断运行位
  41   2           TR1=1;//定时器0运行控制位
  42   2          
  43   2         }
  44   1         else if(time_object->time0==TIME0ON&&time_object->time1==TIME1ON)
  45   1         {
  46   2           EA=0;//中断总控制位
  47   2           TMOD=0x11;//设置定时器1为工作方式1
  48   2         
  49   2           
  50   2           TH1=(65536-(921600/(1000/time_object->time1_ms)))/256;
  51   2           TL1=(65536-(921600/(1000/time_object->time1_ms)))%256;
  52   2           ET1=1;//定时器中断运行位
  53   2           TR1=1;//定时器0运行控制位
  54   2           
C51 COMPILER V9.54   TIME                                                                  09/18/2022 21:48:24 PAGE 2   

  55   2           TH0=(65536-(921600/(1000.0/time_object->time0_ms)))/256;
  56   2           TL0=(65536-(921600/(1000/time_object->time0_ms)))%256;
  57   2           
  58   2           ET0=1;//定时器中断运行位
  59   2           TR0=1;//定时器0运行控制位
  60   2           EA=1;//中断总控制位
  61   2          
  62   2         }
  63   1        
  64   1      }
  65          /**
  66            * @brief          重新填充THX和TLX
  67            * @param[in]      time_object：time对象指针
  68            * @retval         NULL
  69            */
  70          static void time_again_init(create_time * time_object)
  71          {
  72   1        if(time_object->time0==TIME0ON&&time_object->time_type==TIME0)
  73   1        {
  74   2        
  75   2           TH0=(65536-(921600/(1000/time_object->time0_ms)))/256;
  76   2           TL0=(65536-(921600/(1000/time_object->time0_ms)))%256;
  77   2          
  78   2        }
  79   1        else if(time_object->time1==TIME1ON&&time_object->time_type==TIME1)
  80   1        {
  81   2          
  82   2            TH1=(65536-(921600/(1000/time_object->time1_ms)))/256;
  83   2           TL1=(65536-(921600/(1000/time_object->time1_ms)))%256;
  84   2      
  85   2      
  86   2           
  87   2        }
  88   1        
  89   1        
  90   1      
  91   1      }
  92          //定时器0中断函数
  93          void T0_time() interrupt 1
  94          {
  95   1        
  96   1          c51_time.time_type=TIME0;
  97   1          c51_time.time_again_init(&c51_time);
  98   1          c51_time.time_run_func_handle();
  99   1      
 100   1      }
 101          //定时器1中断函数
 102          void T1_time() interrupt 3
 103          {  
 104   1      
 105   1          
 106   1          c51_time.time_type=TIME1;
 107   1          c51_time.time_again_init(&c51_time);
 108   1          c51_time.time_run_func_handle();
 109   1        
 110   1      }
 111          #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1236    ----
   CONSTANT SIZE    =   ----    ----
C51 COMPILER V9.54   TIME                                                                  09/18/2022 21:48:24 PAGE 3   

   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       6
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
