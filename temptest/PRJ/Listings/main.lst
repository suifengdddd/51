C51 COMPILER V9.54   MAIN                                                                  09/18/2022 21:49:35 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\ying_yong\keil5\C51\BIN\C51.EXE ..\SRC\main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\INC) DEBUG OBJE
                    -CTEXTEND PRINT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "STC51.h"
   2          #define SHOW_TEMP 1
   3          #define SHOW_ALARM_TEMP 0
   4          #if TIME_
   5          create_time c51_time;
   6          #endif
   7          #if KEY_
   8          create_key c51_key; 
   9          #endif
  10          #if LED_
              create_led c51_led;
              #endif
  13          #if BEEP_
  14          create_beep c51_beep;
  15          #endif
  16          #if SMG_
  17          create_nixie_tube c51_nixie_tube;
  18          
  19          #endif
  20          #if USART
              create_usart c51_usart;
              #endif
  23          #if DS18B20_
  24          create_temp c51_temp;
  25          #endif
  26          
  27          main()
  28          {
  29   1        
  30   1          int flag=SHOW_TEMP;
  31   1          int tepm_c=280;
  32   1          int arr[6]={0};
  33   1          #if LED_
                 
                  led_init(&c51_led);
                  #endif
  37   1          #if KEY_
  38   1          key_init(&c51_key);
  39   1          #endif
  40   1          #if BEEP_
  41   1          beep_init(&c51_beep);
  42   1          #endif
  43   1          #if SMG_
  44   1          nixie_tube_init(&c51_nixie_tube); 
  45   1          #endif
  46   1      #if TIME_ 
  47   1          //打开定时器0   
  48   1          c51_time.time0=TIME0ON;
  49   1           //10ms一个中断
  50   1          c51_time.time0_ms=50;
  51   1          //关闭定时器1
  52   1          c51_time.time1=TIME1OFF;
  53   1          c51_time.time1_ms=50;
  54   1        
C51 COMPILER V9.54   MAIN                                                                  09/18/2022 21:49:35 PAGE 2   

  55   1          c51_time.time_type=0;
  56   1          time_init(&c51_time);
  57   1      #endif
  58   1        
  59   1      #if USART
                  //设置波特率为9600
                  c51_usart.baud_rate=9600;
                  usart_init(&c51_usart);
              #endif    
  64   1      
  65   1      #if DS18B20_
  66   1          temp_init(&c51_temp);
  67   1      #endif
  68   1          
  69   1      
  70   1          
  71   1        while(1)
  72   1        {
  73   2        
  74   2          c51_temp.begin_temp_change();
  75   2          c51_temp.get_temp(&c51_temp);
  76   2          c51_key.key=c51_key.whitch_key_down(&c51_key);
  77   2          if(c51_key.key==KEY3)
  78   2          {
  79   3            tepm_c=tepm_c+5;
  80   3            c51_key.key=0;
  81   3        
  82   3          }
  83   2          else if(c51_key.key==KEY4)
  84   2          {
  85   3            tepm_c=tepm_c-5;
  86   3            c51_key.key=0;
  87   3            
  88   3            
  89   3          }
  90   2          else if(c51_key.key==KEY2)
  91   2          {
  92   3            flag=~flag;
  93   3            c51_key.key=0;
  94   3          }
  95   2          else if(c51_key.key==KEY5)
  96   2          {
  97   3            c51_temp.temp_max=tepm_c;
  98   3            c51_key.key=0;
  99   3            
 100   3          }
 101   2          if(flag==SHOW_TEMP)
 102   2          {
 103   3            arr[0]=c51_temp.temp/100%10;
 104   3            arr[1]=c51_temp.temp/10%10;
 105   3            arr[2]=c51_temp.temp/1%10;
 106   3          }
 107   2          else 
 108   2          {
 109   3             arr[0]=tepm_c/100%10;
 110   3            arr[1]=tepm_c/10%10;
 111   3            arr[2]=tepm_c/1%10;
 112   3             
 113   3          }
 114   2          
 115   2            if(c51_temp.temp<=c51_temp.temp_max)
 116   2            {
C51 COMPILER V9.54   MAIN                                                                  09/18/2022 21:49:35 PAGE 3   

 117   3              GPIO_1_0=1;
 118   3              BEEP_GPIO=1;
 119   3            }
 120   2            
 121   2          c51_nixie_tube.dynamic_display(1,3,arr);
 122   2          
 123   2          
 124   2           
 125   2      
 126   2        }
 127   1          
 128   1        
 129   1      }
 130          #if USART
              void usart_rx_func_handle (void)
              {
                  unsigned  char  res;
                  RI=0;
                  c51_led.led_on(1);
                  res =SBUF;
                    if((c51_usart.USART_RX_STA&0x8000)==0)//接收未完成
                  {
                    if(c51_usart.USART_RX_STA&0x4000)//接收到了0x0d
                    {
                      if(res!=0x0a)c51_usart.USART_RX_STA=0;//接收错误,重新开始
                      else c51_usart.USART_RX_STA|=0x8000;  //接收完成了 
                    }else //还没收到0X0D
                    { 
                      if(res==0x0d)c51_usart.USART_RX_STA|=0x4000;
                      else
                      {
                        c51_usart.USART_RX_BUF[c51_usart.USART_RX_STA&0X3FFF]=res;
                        c51_usart.USART_RX_STA++;
                        if(c51_usart.USART_RX_STA>(USART_REC_LEN-1))c51_usart.USART_RX_STA=0;//接收数据错误,重新开始接收    
                      }    
                    }
                  }
                       
              }
              #endif
 157          #if TIME_  
 158          void time_run_func_handle(void)
 159          {
 160   1         static int time0_i=0;
 161   1         static int time1_i=0;
 162   1         
 163   1         
 164   1      
 165   1      
 166   1        if(c51_time.time_type==TIME0)
 167   1        {
 168   2          
 169   2      
 170   2           if(c51_temp.temp>c51_temp.temp_max&&time0_i==10)
 171   2           {
 172   3            
 173   3            
 174   3             GPIO_1_0=~GPIO_1_0;
 175   3             BEEP_GPIO=~BEEP_GPIO;
 176   3            
 177   3           }
 178   2           
C51 COMPILER V9.54   MAIN                                                                  09/18/2022 21:49:35 PAGE 4   

 179   2        
 180   2          
 181   2            if(time0_i>10)
 182   2            {
 183   3              time0_i=0;
 184   3            }
 185   2            time0_i++;
 186   2      
 187   2          
 188   2          
 189   2        }
 190   1        else if(c51_time.time_type==TIME1)
 191   1        {
 192   2         
 193   2      
 194   2           if(time0_i%50==0)
 195   2           {
 196   3              //c51_led.led_on(2);
 197   3          }
 198   2          else
 199   2          {
 200   3             //c51_led.led_off(2);
 201   3          }
 202   2        
 203   2          time1_i++;
 204   2      
 205   2      
 206   2        
 207   2        }
 208   1        
 209   1        
 210   1        c51_time.time_type=0;
 211   1        
 212   1      }
 213          #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    445    ----
   CONSTANT SIZE    =     12    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     67      16
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
