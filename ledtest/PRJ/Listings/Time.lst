C51 COMPILER V9.54   TIME                                                                  09/23/2022 12:52:08 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE TIME
OBJECT MODULE PLACED IN .\Objects\Time.obj
COMPILER INVOKED BY: D:\ying_yong\keil5\C51\BIN\C51.EXE ..\CODE\Time.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\INC) DEBUG OBJ
                    -ECTEXTEND PRINT(.\Listings\Time.lst) TABS(2) OBJECT(.\Objects\Time.obj)

line level    source

   1          #include "Time.h"
   2          /*注意当time0和time1同时打开时请设置
   3           *c51_time.time0_ms
   4           *c51_time.time1_ms
   5           *两个都要大于3
   6           *此时如果有动态数码管那么会看到明显闪烁
   7           *平常使用时尽量只开一个定时器
   8           */
   9          #if TIME_
  10          
  11          static void time_again_init(create_time * time_object);
  12          /**
  13            * @brief          初始化time对象
  14            * @param[in]      time_object：time对象指针
  15            * @retval         NULL
  16            */
  17          void time_init(create_time *time_object)
  18          {
  19   1         time_object->time_run_func_handle=time_run_func_handle;
  20   1         time_object->time_again_init=time_again_init;
  21   1        
  22   1        
  23   1         if(time_object->time0==TIME0ON&&time_object->time1==TIME1OFF)
  24   1         {
  25   2            
  26   2           TMOD=0x01;//设置定时器0为工作方式1
  27   2           TH0=(65536-(921600/(1000/time_object->time0_ms)))/256;
  28   2           TL0=(65536-(921600/(1000/time_object->time0_ms)))%256;
  29   2           EA=1;//中断总控制位
  30   2           ET0=1;//定时器中断运行位
  31   2           TR0=1;//定时器0运行控制位
  32   2           
  33   2         }
  34   1         else if(time_object->time0==TIME0OFF&&time_object->time1==TIME1ON)
  35   1         {
  36   2            
  37   2           TMOD=0x10;//设置定时器1为工作方式1
  38   2           TH1=(65536-(921600/(1000/time_object->time1_ms)))/256;
  39   2           TL1=(65536-(921600/(1000/time_object->time1_ms)))%256;
  40   2           EA=1;//中断总控制位
  41   2           ET1=1;//定时器中断运行位
  42   2           TR1=1;//定时器0运行控制位
  43   2          
  44   2         }
  45   1         else if(time_object->time0==TIME0ON&&time_object->time1==TIME1ON)
  46   1         {
  47   2           EA=0;//中断总控制位
  48   2           TMOD=0x11;//设置定时器1为工作方式1
  49   2         
  50   2           
  51   2           TH1=(65536-(921600/(1000/time_object->time1_ms)))/256;
  52   2           TL1=(65536-(921600/(1000/time_object->time1_ms)))%256;
  53   2           ET1=1;//定时器中断运行位
  54   2           TR1=1;//定时器0运行控制位
C51 COMPILER V9.54   TIME                                                                  09/23/2022 12:52:08 PAGE 2   

  55   2           
  56   2           TH0=(65536-(921600/(1000.0/time_object->time0_ms)))/256;
  57   2           TL0=(65536-(921600/(1000/time_object->time0_ms)))%256;
  58   2           
  59   2           ET0=1;//定时器中断运行位
  60   2           TR0=1;//定时器0运行控制位
  61   2           EA=1;//中断总控制位
  62   2          
  63   2         }
  64   1        
  65   1      }
  66          /**
  67            * @brief          重新填充THX和TLX
  68            * @param[in]      time_object：time对象指针
  69            * @retval         NULL
  70            */
  71          static void time_again_init(create_time * time_object)
  72          {
  73   1        if(time_object->time0==TIME0ON&&time_object->time_type==TIME0)
  74   1        {
  75   2        
  76   2           TH0=(65536-(921600/(1000/time_object->time0_ms)))/256;
  77   2           TL0=(65536-(921600/(1000/time_object->time0_ms)))%256;
  78   2          
  79   2        }
  80   1        else if(time_object->time1==TIME1ON&&time_object->time_type==TIME1)
  81   1        {
  82   2          
  83   2            TH1=(65536-(921600/(1000/time_object->time1_ms)))/256;
  84   2           TL1=(65536-(921600/(1000/time_object->time1_ms)))%256;
  85   2      
  86   2      
  87   2           
  88   2        }
  89   1        
  90   1        
  91   1      
  92   1      }
  93          //定时器0中断函数
  94          void T0_time() interrupt 1
  95          {
  96   1        
  97   1          c51_time.time_type=TIME0;
  98   1          c51_time.time_again_init(&c51_time);
  99   1          c51_time.time_run_func_handle();
 100   1      
 101   1      }
 102          //定时器1中断函数
 103          void T1_time() interrupt 3
 104          {  
 105   1      
 106   1          
 107   1          c51_time.time_type=TIME1;
 108   1          c51_time.time_again_init(&c51_time);
 109   1          c51_time.time_run_func_handle();
 110   1        
 111   1      }
 112          #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1236    ----
C51 COMPILER V9.54   TIME                                                                  09/23/2022 12:52:08 PAGE 3   

   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       6
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
