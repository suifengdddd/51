C51 COMPILER V9.54   MAIN                                                                  09/22/2022 17:36:53 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\ying_yong\keil5\C51\BIN\C51.EXE ..\SRC\main.c COMPACT OPTIMIZE(8,SPEED) BROWSE INCDIR(..\INC) DE
                    -BUG OBJECTEXTEND PRINT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "STC51.h"
   2          #if TIME_
              create_time c51_time;
              #endif
   5          #if KEY_
              create_key c51_key; 
              #endif
   8          #if LED_
              create_led c51_led;
              #endif
  11          #if BEEP_
              create_beep c51_beep;
              #endif
  14          #if SMG_
  15          create_nixie_tube c51_nixie_tube;
  16          
  17          #endif
  18          #if USART
              create_usart c51_usart;
              #endif
  21          
  22          #if LCD1602_
  23          create_lcd c51_lcd1602;
  24          #endif
  25          
  26          main()
  27          {
  28   1          
  29   1          
  30   1          #if LED_
                  int arr[8]={LED1,OFF,LED3,OFF,0,0,0,0};
                  led_init(&c51_led);
                  #endif
  34   1          #if KEY_
                  key_init(&c51_key);
                  #endif
  37   1          #if BEEP_
                  beep_init(&c51_beep);
                  #endif
  40   1          #if SMG_
  41   1          nixie_tube_init(&c51_nixie_tube); 
  42   1          #endif
  43   1      #if TIME_ 
                  //打开定时器0   
                  c51_time.time0=TIME0OFF;
                   //10ms一个中断
                  c51_time.time0_ms=50;
                  //关闭定时器1
                  c51_time.time1=TIME1OFF;
                  c51_time.time1_ms=50;
                
                  c51_time.time_type=0;
                  time_init(&c51_time);
              #endif
C51 COMPILER V9.54   MAIN                                                                  09/22/2022 17:36:53 PAGE 2   

  55   1        
  56   1      #if USART
                  //设置波特率为9600
                  c51_usart.baud_rate=9600;
                  usart_init(&c51_usart);
              #endif    
  61   1      
  62   1      #if LCD1602_
  63   1      lcd1602_init(&c51_lcd1602);
  64   1      #endif
  65   1          
  66   1      
  67   1      
  68   1         
  69   1          c51_lcd1602.show_data("I LOVE CHINA!",0x80);
  70   1          c51_lcd1602.show_data("WWW.TXMCU.COM",0x80+0x40);
  71   1          delayms(2000);
  72   1          c51_lcd1602.write_com(0x01);
  73   1          c51_lcd1602.show_data("Hello  everyone!",0x80);
  74   1          c51_lcd1602.show_data("Welcome to here!",0x80+0x40);
  75   1          
  76   1          while(1)
  77   1          {
  78   2          
  79   2          }
  80   1      
  81   1        
  82   1          
  83   1        
  84   1      }
  85          #if USART
              void usart_rx_func_handle (void)
              {
                  unsigned  char  res;
                  RI=0;
                  c51_led.led_on(1);
                  res =SBUF;
                    if((c51_usart.USART_RX_STA&0x8000)==0)//接收未完成
                  {
                    if(c51_usart.USART_RX_STA&0x4000)//接收到了0x0d
                    {
                      if(res!=0x0a)c51_usart.USART_RX_STA=0;//接收错误,重新开始
                      else c51_usart.USART_RX_STA|=0x8000;  //接收完成了 
                    }else //还没收到0X0D
                    { 
                      if(res==0x0d)c51_usart.USART_RX_STA|=0x4000;
                      else
                      {
                        c51_usart.USART_RX_BUF[c51_usart.USART_RX_STA&0X3FFF]=res;
                        c51_usart.USART_RX_STA++;
                        if(c51_usart.USART_RX_STA>(USART_REC_LEN-1))c51_usart.USART_RX_STA=0;//接收数据错误,重新开始接收    
                      }    
                    }
                  }
                       
              }
              #endif
 112          #if TIME_  
              void time_run_func_handle(void)
              {
                 static int time0_i=0;
                 static int time1_i=0;
C51 COMPILER V9.54   MAIN                                                                  09/22/2022 17:36:53 PAGE 3   

                 
                 
              
              
                if(c51_time.time_type==TIME0)
                {
                  
              
                   
              
                  
                
                   time0_i++;
              
                   if(time0_i>20)
                   {
                     time0_i=0;
                   }
                  
                }
                else if(c51_time.time_type==TIME1)
                {
                 
              
                   if(time0_i%50==0)
                   {
                      //c51_led.led_on(2);
                  }
                  else
                  {
                     //c51_led.led_off(2);
                  }
                
                  time1_i++;
              
              
                
                }
                
                
                c51_time.time_type=0;
                
              }
              #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    147    ----
   CONSTANT SIZE    =     62    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =     24    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
