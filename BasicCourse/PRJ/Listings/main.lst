C51 COMPILER V9.54   MAIN                                                                  09/07/2022 14:43:14 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\ying_yong\keil5\C51\BIN\C51.EXE ..\SRC\main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\INC) DEBUG OBJE
                    -CTEXTEND PRINT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "STC51.h"
   2          #if TIME_
   3          create_time c51_time;
   4          #endif
   5          #if KEY_
   6          create_key c51_key; 
   7          #endif
   8          #if LED_
   9          create_led c51_led;
  10          #endif
  11          #if BEEP_
  12          create_beep c51_beep;
  13          #endif
  14          #if SMG_
  15          create_nixie_tube c51_nixie_tube;
  16          
  17          #endif
  18          #if USART
              create_usart c51_usart;
              #endif
  21          
  22          main()
  23          {
  24   1        
  25   1         // int i=1;
  26   1          
  27   1          #if LED_
  28   1          int arr[8]={LED1,OFF,LED3,OFF,0,0,0,0};
  29   1          led_init(&c51_led);
  30   1          #endif
  31   1          #if KEY_
  32   1          key_init(&c51_key);
  33   1          #endif
  34   1          #if BEEP_
  35   1          beep_init(&c51_beep);
  36   1          #endif
  37   1          #if SMG_
  38   1          nixie_tube_init(&c51_nixie_tube); 
  39   1          #endif
  40   1      #if TIME_ 
  41   1          //打开定时器0   
  42   1          c51_time.time0=TIME0ON;
  43   1           //10ms一个中断
  44   1          c51_time.time0_ms=1;
  45   1          //关闭定时器1
  46   1          c51_time.time1=TIME1OFF;
  47   1          c51_time.time1_ms=3;
  48   1        
  49   1          c51_time.time_type=0;
  50   1          time_init(&c51_time);
  51   1      #endif
  52   1        
  53   1      #if USART
                  //设置波特率为9600
C51 COMPILER V9.54   MAIN                                                                  09/07/2022 14:43:14 PAGE 2   

                  c51_usart.baud_rate=9600;
                  usart_init(&c51_usart);
              #endif    
  58   1          
  59   1      
  60   1          
  61   1        while(1)
  62   1        {
  63   2        
  64   2      //     c51_key.key=c51_key.whitch_key_down();
  65   2      //     c51_nixie_tube.arr[0]=c51_key.key/10;
  66   2      //     c51_nixie_tube.arr[1]=c51_key.key%10;
  67   2      //     if(c51_key.key/8==0&&c51_key.key%8==0)
  68   2      //     { 
  69   2      //        c51_led.led_all_off();
  70   2      //     }
  71   2           c51_led.led_flicker(1,100);
  72   2           c51_led.led_flicker(2,100);
  73   2      //    c51_nixie_tube.dynamic_display(1,6,c51_nixie_tube.arr);
  74   2      
  75   2        }
  76   1          
  77   1        
  78   1      }
  79          #if USART
              void usart_rx_func_handle (void)
              {
                  unsigned  char  res;
                  RI=0;
                  c51_led.led_on(1);
                  res =SBUF;
                    if((c51_usart.USART_RX_STA&0x8000)==0)//接收未完成
                  {
                    if(c51_usart.USART_RX_STA&0x4000)//接收到了0x0d
                    {
                      if(res!=0x0a)c51_usart.USART_RX_STA=0;//接收错误,重新开始
                      else c51_usart.USART_RX_STA|=0x8000;  //接收完成了 
                    }else //还没收到0X0D
                    { 
                      if(res==0x0d)c51_usart.USART_RX_STA|=0x4000;
                      else
                      {
                        c51_usart.USART_RX_BUF[c51_usart.USART_RX_STA&0X3FFF]=res;
                        c51_usart.USART_RX_STA++;
                        if(c51_usart.USART_RX_STA>(USART_REC_LEN-1))c51_usart.USART_RX_STA=0;//接收数据错误,重新开始接收    
                      }    
                    }
                  }
                       
              }
              #endif
 106          #if TIME_  
 107          void time_run_func_handle(void)
 108          {
 109   1      
 110   1         
 111   1         
 112   1      
 113   1      
 114   1        if(c51_time.time_type==TIME0)
 115   1        {
 116   2          
C51 COMPILER V9.54   MAIN                                                                  09/07/2022 14:43:14 PAGE 3   

 117   2      
 118   2           
 119   2      //     c51_beep.inpt_time=20;
 120   2      //     c51_beep.in_time_interrupt(100,0.5);
 121   2         
 122   2      //     if(time0_i%2==0)
 123   2      //     {
 124   2      //     c51_nixie_tube.show_number(1,c51_nixie_tube.arr[0]);
 125   2      //     }
 126   2      //     else
 127   2      //     {
 128   2      //     c51_nixie_tube.show_number(2,c51_nixie_tube.arr[1]);
 129   2      //     }
 130   2      
 131   2          
 132   2        
 133   2           c51_time.time0_i++;
 134   2           if(c51_time.time0_i>=5000)
 135   2           {
 136   3             c51_time.time0_i=0;
 137   3           }
 138   2           
 139   2      
 140   2          
 141   2          
 142   2        }
 143   1        else if(c51_time.time_type==TIME1)
 144   1        {
 145   2         
 146   2      
 147   2           if(c51_time.time1_i%50==0)
 148   2           {
 149   3              //c51_led.led_on(2);
 150   3          }
 151   2          else
 152   2          {
 153   3             //c51_led.led_off(2);
 154   3          }
 155   2        
 156   2          c51_time.time1_i++;
 157   2         if(c51_time.time1_i>=5000)
 158   2           {
 159   3             c51_time.time1_i=0;
 160   3           }
 161   2           
 162   2      
 163   2        
 164   2        }
 165   1        
 166   1        
 167   1        c51_time.time_type=0;
 168   1        
 169   1      }
 170          #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    182    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     70      16
C51 COMPILER V9.54   MAIN                                                                  09/07/2022 14:43:14 PAGE 4   

   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
